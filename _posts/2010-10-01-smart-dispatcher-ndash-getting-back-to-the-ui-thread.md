---
layout: post
title: Smart Dispatcher – Getting Back to the UI Thread
date: 2010-10-01 02:12
author: John
comments: true
categories: [Silverlight]
---
<p>When you work with Silverlight classic or for Windows Phone everyday like I do, you get used writing code that helps you get back on the UI thread when needed. </p>  <blockquote>   <p>I was chatting with Jeff Wilcox about threading and I tossed this code at him, as <a href="http://www.jeff.wilcox.name/2010/04/propertychangedbase-crossthread/">Jeff also has a SmartDispatcher class</a>. Mine is a much smaller feature set than Jeff’s, but it does the job I need. Anyway, the discussion with Jeff made me realize I had not shared this code.</p> </blockquote>  <p>Sometimes your code runs on a background thread, for example, and you need to do something to the UI. But you are on the background thread and can’t affect the UI from there, so what do you do? You use the Dispatcher (or SynchronizationContext class) to help you get back to the UI thread. There are several ways to do this, but the most common one I use is via a SmartDispatcher class I created recently. </p>  <p>I admit that until I created this class I was rewriting the code in every place I needed it. Not a good thing. So recently I created this class with a single method, BeginInvoke. It checks if I am running in the designer or if I am already on the UI thread. If either is true, I just run the Action since there is no need to use the Dispatcher. If I’m at runtime and I am not on the UI thread, I execute the Action through the Dispatcher. Pretty simple.</p>  <div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">   <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> SmartDispatcher<br />{<br />    <span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">void</span> BeginInvoke(Action action)<br />    {<br />        <span style="color: #0000ff">if</span> (Deployment.Current.Dispatcher.CheckAccess() <br />            || DesignerProperties.IsInDesignTool)<br />        {<br />            action();<br />        }<br />        <span style="color: #0000ff">else</span><br />        {<br />            Deployment.Current.Dispatcher.BeginInvoke(action);<br />        }<br />    }<br />}<br /></pre>
<br /></div>
<p>&#160;</p>
<p>So any place I need to execute on the UI thread I do something like this:</p>
<div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
<pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet">SmartDispatcher.BeginInvoke(() =&gt;<br />{<br />    IsBusy = <span style="color: #0000ff">false</span>;<br />    Widgets = widgetsResponseSet;<br />});<br /></pre>
<br /></div>

