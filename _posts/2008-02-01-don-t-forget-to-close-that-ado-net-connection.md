---
layout: post
title: Don't forget to Close that ADO.NET Connection
date: 2008-02-01 18:39
author: John
comments: true
categories: [All]
---
Here's a quick tip in response to some questions I recently have been asked by several readers & bloggers: When using the Command.ExecuteReader method to get a DataReader, pass it the System.Data.CommandBehavior.CloseConnection argument. This argument closes the Connection when the DataReader is closed. Thus, this can save you a line of code to close your Connection. OK, 1 measely line isn't much to talk about, but then again it can solve another problem that we all run into from time to time: cleaning up our room. No, wait, I mean cleaning up our resources. It is easy to forget to close the connection when you are done with it. <br> <br> If you run the following code in debug mode, you will see the state of the connection at various points. The key here is that as soon as the DataReader is closed, the connection is also closed. (The code sample assumes that you have a button named Button1 and a TextBox named Text1 in an ASP.NET Web Form.) This is not rocket science, but then again, it can help you code better! <br> <br> <fieldset><legend>CommandBehavior.CloseConnection</legend> <font size="2" color="#000000"> <br> <font size="2" color="#0000ff">private void</font> Button1_Click(<font size="2" color="#0000ff">object</font> sender, System.EventArgs e) <br> { <br> &nbsp;&nbsp;&nbsp;&nbsp;<font size="2" color="#0000ff">string</font> sConnString = "Server=localhost;Database=Northwind;Integrated Security=True"; <br> &nbsp;&nbsp;&nbsp;&nbsp;<font size="2" color="#0000ff">string</font> sSql = "SELECT CategoryID, CategoryName FROM Categories ORDER BY CategoryName"; <br> &nbsp;&nbsp;&nbsp;&nbsp;SqlConnection cn = <font size="2" color="#0000ff">new</font> SqlConnection(sConnString); <br> &nbsp;&nbsp;&nbsp;&nbsp;SqlCommand cmd = <font size="2" color="#0000ff">new</font> SqlCommand(sSql, cn); <br> &nbsp;&nbsp;&nbsp;&nbsp;cn.Open(); <br> &nbsp;&nbsp;&nbsp;&nbsp;System.Diagnostics.Debug.WriteLine("[Pre Loop] - Connection State is " + cn.State.ToString()); <br> &nbsp;&nbsp;&nbsp;&nbsp;SqlDataReader rdr = cmd.ExecuteReader(System.Data.CommandBehavior.CloseConnection); <br> &nbsp;&nbsp;&nbsp;&nbsp;<font size="2" color="#0000ff">while</font> (rdr.Read()) <br> &nbsp;&nbsp;&nbsp;&nbsp;{ <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Diagnostics.Debug.WriteLine("[Looping] - Connection State is " + cn.State.ToString()); <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TextBox1.Text += rdr["CategoryName"].ToString() + Environment.NewLine; <br> &nbsp;&nbsp;&nbsp;&nbsp;} <br> &nbsp;&nbsp;&nbsp;&nbsp;rdr.Close(); <br> &nbsp;&nbsp;&nbsp;&nbsp;System.Diagnostics.Debug.WriteLine("[Post Loop] - Connection State is " + cn.State.ToString()); <br> } <br> </font> </fieldset> <br>

