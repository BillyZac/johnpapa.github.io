<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Build Single Page Apps - Part 8 - JavaScript Data Services</title>
    
    <meta name="author" content="John Papa">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

    <!-- Le styles -->
    <link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
    <link href="/assets/css/style.css" rel="stylesheet">

    <link rel="shortcut icon" type="image/x-icon" href="assets/ico/favicon.ico">

    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

    <link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">

</head>

<body>
    <nav class="navbar navbar-default visible-xs" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            
            <a type="button" class="navbar-toggle nav-link" href="http://github.com/johnpapa">
                <i class="fa fa-github"></i>
            </a>
            
            
            <a type="button" class="navbar-toggle nav-link" href="http://twitter.com/john_papa">
                <i class="fa fa-twitter"></i>
            </a>
            
            
            <a class="navbar-brand" href="/">
                <img src="http://www.gravatar.com/avatar/0d3794fe37746ea54926ca6878712721?s=35" class="img-circle" />
                
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li class="active"><a href="/">Home</a></li>
                <li><a href="/categories.html">Categories</a></li>
                <li><a href="/tags.html">Tags</a></li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>

    <!-- nav-menu-dropdown -->
    <div class="btn-group hidden-xs" id="nav-menu">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <i class="fa fa-bars"></i>
        </button>
        <ul class="dropdown-menu" role="menu">
            <li><a href="/"><i class="fa fa-home"></i>Home</a></li>
            <li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
            <li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
            <li class="divider"></li>
            <li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
        </ul>
    </div>

    <div class="col-sm-4 sidebar hidden-xs hidden-sm not-mobile">
        <!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<h1 class="text-center">John Papa</h1>
	<a href="/">
		<img src="http://www.gravatar.com/avatar/0d3794fe37746ea54926ca6878712721?s=150" class="img-circle" />
	</a>
	<h3 class="title">
		<a href="/"></a>
	</h3>
</header>


<div id="bio" class="text-center">
	Evangelist on the Loose
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/johnpapa">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/john_papa">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>

	<div class="sidebar-content">

		<nav id="page-nav">
			<ul class="main-navigation list-unstyled list-inline">
				<li><a href="/about/">About</a></li>
				<li><a href="/articles">Articles</a></li>
				<li><a href="/spa">SPA</a></li>
				<li><a href="/videos">Videos</a></li>
			</ul>
		</nav>

		<h5>Recent Posts</h5>
		<ul class="list-unstyled">
			
				<li>
					<span>16 Sep 2015</span> &raquo;
					<a href="/angular/angular2/community/event/javascript/uncategorized/2015/09/16/angular-2-hack-night-coming-to-orlando.html">
					Angular 2 Hack Night Coming to Orlando</a>
				</li>
			
				<li>
					<span>29 Aug 2015</span> &raquo;
					<a href="/angular/asp.net/github/gulp/html5/javascript/pluralsight/typescript/uncategorized/visual%20studio%20code/2015/08/29/learning-visual-studio-code.html">
					Learning Visual Studio Code</a>
				</li>
			
				<li>
					<span>23 May 2015</span> &raquo;
					<a href="/uncategorized/2015/05/23/visual-studio-code-webinar.html">
					Visual Studio Code Webinar</a>
				</li>
			
				<li>
					<span>23 May 2015</span> &raquo;
					<a href="/uncategorized/2015/05/23/automatically-restarting-asp-net-on-osx-with-dnxmon.html">
					Automatically Restarting ASP.NET on OSX with DNXMON</a>
				</li>
			
				<li>
					<span>23 May 2015</span> &raquo;
					<a href="/uncategorized/2015/05/23/getting-started-with-asp-net-5-on-osx.html">
					Getting Started with ASP.NET 5 on OSX</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/refactoring-with-visual-studio-code.html">
					Refactoring with Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/intellisense-witha-visual-studio-code.html">
					Intellisense with Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/git-and-preferences-in-visual-studio-code.html">
					Git and Preferences in Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/debugging-with-visual-studio-code.html">
					Debugging with Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/visual-studio-code.html">
					Introducing Visual Studio Code</a>
				</li>
			
		</ul>
	</div>

</div>
<!-- sidebar.html end -->
        <div class="not-mobile row sidebar-extras">
            <table class="col-centered">
                <tbody>
                    <tr>
                        <td>
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="160x600"></div>
                        </td>
                        <td>
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="160x600"></div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="300x250"></div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="300x250"></div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="col-sm-8">
        <div class="page-header">
  <h1>Build Single Page Apps - Part 8 - JavaScript Data Services </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   August 
	   26th,
	   
	   2012
	 </span>
	  <div class="article_body">
	  <p>I love to write code, but that doesn’t mean I want to write the same code over and over again. And I certainly don’t want to have to hunt down all that redundant code when I want to refactor a few pieces of it. That’s why I am a huge advocate for the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">Single Responsibility Principle (SRP)</a> … or in simplest terms, I prefer to make smaller sets of code that have a primary focus. In JavaScript, that means modules like the ones below.</p>

<p><a href="/wp-content/uploads/media/Windows-Live-Writer/Build-Single-Page-Apps---Part-8---Data-S_14EC6/image_4.png"><img style="background-image: none; padding-left: 0px; padding-right: 0px; display: block; float: none; margin-left: auto; margin-right: auto; padding-top: 0px; border-width: 0px;" title="image" src="/wp-content/uploads/media/Windows-Live-Writer/Build-Single-Page-Apps---Part-8---Data-S_14EC6/image_thumb_1.png" alt="image" width="520" height="307" border="0" /></a></p>

<p>You’ll see examples of modules such as Models, a Data Service and a Data Context in my upcoming <a href="http://www.pluralsight.com/">Pluralsight</a> course titled “Building Single Page Apps (SPA) with HTML5, ASP.NET Web API, Knockout and jQuery”. (due to go live on Pluralsight in a week!).</p>

<p>You can catch up on the previous posts in this series here:</p>
<h2>More on the Code Camper SPA</h2>
<p>Part 1 - <a href="http://jpapa.me/spapost1">The Story Begins (What is the Code Camper SPA?)</a></p>

<p>Part 2 - <a href="http://jpapa.me/spapost2">Client Technologies</a></p>

<p>Part 3 - <a href="/spapost3">Server Technologies (the Data Layer)</a></p>

<p>Part 4 - <a href="http://jpapa.me/spapost4">Serving JSON with ASP.NET Web API</a></p>

<p>Part 5 - <a href="http://jpapa.me/spapost5">HTML 5 and ASP.NET Web Optimization</a></p>

<p>Part 6 - <a href="http://jpapa.me/spapost6">JavaScript Modules</a></p>

<p>Part 7 - <a href="http://jpapa.me/spapost7">MVVM and KnockoutJS</a></p>

<p>Part 8 - <a href="http://jpapa.me/spapost8">Data Services on the Client</a></p>

<p>Part 9 - <a href="http://jpapa.me/spapost9">Navigation, Transitions, Storage and Messaging</a></p>

<p>Part 10 - <a href="http://jpapa.me/spapost10">Saving, Change Tracking, and Commanding</a></p>

<p>Part 11 - Responsive Design and Mobility</p>
<h2>Data Context</h2>
<p>In the previous post (part 7) I discussed how I prefer the data binding techniques of KnockoutJS and the MVVM pattern in JavaScript. You can go check out an example of a ViewModel in that post. The ViewModel has a method named getSpeaker which defers its data retrieval to a datacontext module. It goes something like this:</p>
<pre class="csharpcode">datacontext.persons.getFullPersonById( currentSpeakerId() );</pre>
<p> </p>

<p>All view models in the application need data. When they need to get it or save it, they turn to the datacontext module who is responsible for getting or saving the data. Sound simple? Well, that’s the point. This data context module is like a client side repository.</p>

<p>The view model doesn’t care how the data is retrieved, it doesn’t care if its going to require an asynchronous call or not, it just wants the data. The datacontext hides all of the logic to retrieve (or save) the data so the view models just interact with the datacontext’s API.</p>
<h2>Smart Caching</h2>
<p>The datacontext in my app is smart enough to hang onto data once it gets it. When a request comes in for data, the datacontext checks if it has the data already. If so, it returns it. If not, it goes and gets it via an Ajax call (actually it defers the retrieval to a Data Service module … but more on that in a minute).</p>

<p>The datacontext’s getData method looks something like this (I shortened it just to get the main points across)</p>
<pre class="csharpcode">getData = function(...) {
<span class="kwrd">return</span> $.Deferred(function(def) {
<span class="rem">// If the internal items object doesnt exist, </span>
<span class="rem">// or we force a refresh</span>
<span class="kwrd">if</span> (forceRefresh || !items) {
getFunction({
success: function(dtoList) {
mapToContext(...);
def.resolve(results);
},
error: function (response) {
logger.error(config.toasts.errorGettingData);
def.reject();
}
}, param);
} <span class="kwrd">else</span> {
itemsToArray(...);
def.resolve(results);
}
}).promise();
}</pre>
<h1>Consistent Expectations</h1>
<p>Pay particular attention to the $.Deferred in this code. This function always returns a promise to the caller (the view model in my example). This provides a consistent expectations to the caller whether the data was retrieved from cache (which doesn’t require an async call) or an async Ajax call to the Web API on the server. This makes it easy to call the code and test it. (Yup, there’s unit tests in my app.)</p>
<h2>Data Service</h2>
<p>I mentioned that the data context handles getting and saving the data. That’s true, but more specifically it handles the job of figuring out how whether it has the data or not, and then if it does not have the data it asks the dataservice module to go get it.</p>

<p>The Data Service module (aka dataservice) makes the request for the data from whatever web service it needs to talk to. It has a simple interface so the datacontext can simply make a request like this:</p>

<p>dataservice.person.getPersons()</p>

<p>Remember that getFunction call up in the datacontext code we just looked at? If not, go look. I’ll wait.</p>

<p>That getFunction call is a delegate for the dataservice.person.getPersons (for example). So if we call it directly we could do it like this:</p>
<pre class="csharpcode">dataservice.person.getSpeakers({
success: function() { ... },
error: function() { ... }
});</pre>
<h2>The Payoff</h2>
<p>This abstraction of data services and data contexts makes it simple to make calls for the same data from multiple places (including view models). So I reap the benefits of:</p>
<ol>
	<li>Code re-use and less repeating myself (DRY)</li>
	<li>Testable modules</li>
	<li>Easier maintenance (when refactoring)</li>
</ol>
<p>In the course I go deeper into these topics and how the data service promotes the use of switching between sample (or mock) data and live data. There are also modules for model factories for the observables (if you so choose to create them).</p>
<h2>Make it Your Own</h2>
<p>I’m very excited to see how people refactor the sample app I include in the course (for Plus subscribers) to add their own ideas. There are so many other angles I would love to have hit, but I made the decision early on to choose one path and explain it.Otherwise there was too much risk of getting myself derailed. The course follows one option for building a SPA but I also can see myself expanding on it for a follow up later. Sigh … but first, I’ll finish this series (next up, navigation) … then I need a vacation <img class="wlEmoticon wlEmoticon-smile" style="border-style: none;" src="/wp-content/uploads/media/Windows-Live-Writer/Build-Single-Page-Apps---Part-8---Data-S_14EC6/wlEmoticon-smile_2.png" alt="Smile" /></p>

<p> </p>
<h2><span style="color: #ff0000;"><strong>UPDATE: </strong></span></h2>
<p>I wrote myself a reminder (and promptly forgot) to mention 2 libraries that could replace my datacontext module. I am looking forward to when they go to their final release stage: Upshot.js and <a href="http://www.breezejs.com/">BreezeJS</a>. Upshot (by the Microsoft ASP.NET team) has been around for a while in pre-release form, but it’s not at a point where I feel comfortable using it just yet. However it has a lot of potential and I am all over it once it is released. The other is BreezeJS, by <a href="http://www.ideablade.com/">ideablade</a>. These guys have been in this space before with WinForms, Silverlight, WPF and are BreezeJS is there new JavaScript offerring. Breeze is not out yet but will be here soon, I am told. Neither is something I would use today, but both are intriguing enough where it could dramatically simplify (and reduce or eliminate) my datacontext module with the same and even more functionality. I’m all for “better”!</p>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#data-ref">
					data <span>(2)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#patterns-ref">
					patterns <span>(11)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#pluralsight-ref">
					pluralsight <span>(49)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#spa-ref">
					spa <span>(37)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#uncategorized-ref">
					uncategorized <span>(150)</span>
					
				</a></li>
			
		  
		</ul>
		  

		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=Build Single Page Apps - Part 8 - JavaScript Data Services&via=john_papa"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="http://www.gravatar.com/avatar/0d3794fe37746ea54926ca6878712721" class="img-rounded author-image" />
        <h4 class="section-title author-name">John Papa</h4>
        <p class="author-bio">Evangelist on the Loose</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/pluralsight/2012/08/23/unique-pluralsight-video-call-me-maybe.html" title="Unique Pluralsight Video - Call Me Maybe">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/free300th/2012/08/30/pluralsight-spa-javascript-jquery-html5-asp-net.html" title="Free Pluralsight Course on SPAs for the 48 Hours">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>



    
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'johnpapa';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>





      <footer class="footer-text">
        <hr/>
        <p>
        Copyright © 2015 - John Papa Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/">CC BY 2.5</a>
        | Unless otherwise stated or granted, code samples licensed under the <a href="http://sm.mit-license.org/">MIT license</a>.
        | Site design based on the <a href="https://github.com/dbtek/dbyll">dbyll theme</a> under the <a href="http://sm.mit-license.org/">MIT license</a>
      </p>

      </footer>

    </div>

    <script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/app.js"></script>

    <!--Developer Media Links-->
    <script type='text/javascript'>
        function _dmBootstrap(file) {
    var _dma = document.createElement('script'); _dma.type = 'text/javascript'; _dma.async = true; _dma.src = ('https:' == document.location.protocol ? 'https://' : 'http://')
    + file;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(_dma);
    }
    function _dmFollowup(file) { if (typeof DMAds === 'undefined') _dmBootstrap('cdn2.DeveloperMedia.com/a.min.js');}
    (function () { _dmBootstrap('cdn1.DeveloperMedia.com/a.min.js');
    setTimeout(_dmFollowup, 2000);})();
    </script>

    <!--<script language="JavaScript" src="http://ad.doubleclick.net/N6839/adj/lqm.johnpapa.site/ron;kw=%2Cjohn%2Cpapa%2Cblog%2Cjohnpapa%7Bdot%7Dnet%2Cjohnpapa%2Cpappa%2Cwww%7Bdot%7Djohnpapa%7Bdot%7Dnet%2Cjon%2Cangular%2Cjhon;sz=160x600;dc_ref=http%3A%2F%2Fwww.johnpapa.net%2F;tile=1;ord=BEAAB484DA88D8D84B9DCB004E5712BE?"
    type="text/javascript"></script>-->

    <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="728x90" class="col-centered"></div>

</body>

</html>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'johnpapa']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

