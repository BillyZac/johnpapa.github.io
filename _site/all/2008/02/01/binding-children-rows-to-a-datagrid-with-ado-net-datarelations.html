<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Binding Children Rows to a DataGrid with ADO.NET DataRelations</title>
    
    <meta name="author" content="John Papa">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

    <!-- Le styles -->
    <link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
    <link href="/assets/css/style.css" rel="stylesheet">

    <link rel="shortcut icon" type="image/x-icon" href="assets/ico/favicon.ico">

    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

    <link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">

</head>

<body>
    <nav class="navbar navbar-default visible-xs" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            
            <a type="button" class="navbar-toggle nav-link" href="http://github.com/johnpapa">
                <i class="fa fa-github"></i>
            </a>
            
            
            <a type="button" class="navbar-toggle nav-link" href="http://twitter.com/john_papa">
                <i class="fa fa-twitter"></i>
            </a>
            
            
            <a class="navbar-brand" href="/">
                <img src="http://www.gravatar.com/avatar/0d3794fe37746ea54926ca6878712721?s=35" class="img-circle" />
                
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li class="active"><a href="/">Home</a></li>
                <li><a href="/categories.html">Categories</a></li>
                <li><a href="/tags.html">Tags</a></li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>

    <!-- nav-menu-dropdown -->
    <div class="btn-group hidden-xs" id="nav-menu">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <i class="fa fa-bars"></i>
        </button>
        <ul class="dropdown-menu" role="menu">
            <li><a href="/"><i class="fa fa-home"></i>Home</a></li>
            <li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
            <li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
            <li class="divider"></li>
            <li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
        </ul>
    </div>

    <div class="col-sm-4 sidebar hidden-xs hidden-sm not-mobile">
        <!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<h1 class="text-center">John Papa</h1>
	<a href="/">
		<img src="http://www.gravatar.com/avatar/0d3794fe37746ea54926ca6878712721?s=150" class="img-circle" />
	</a>
	<h3 class="title">
		<a href="/"></a>
	</h3>
</header>


<div id="bio" class="text-center">
	Evangelist on the Loose
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/johnpapa">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		 
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/john_papa">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		 
	</ul>

	<div class="sidebar-content">

		<nav id="page-nav">
			<ul class="main-navigation list-unstyled list-inline">
				<li><a href="/about/">About</a></li>
				<li><a href="/articles">Articles</a></li>
				<li><a href="/spa">SPA</a></li>
				<li><a href="/videos">Videos</a></li>
			</ul>
		</nav>

		<h5>Recent Posts</h5>
		<ul class="list-unstyled">
			
				<li>
					<span>16 Sep 2015</span> &raquo;
					<a href="/angular/angular2/community/event/javascript/uncategorized/2015/09/16/angular-2-hack-night-coming-to-orlando.html">
					Angular 2 Hack Night Coming to Orlando</a>
				</li>
			
				<li>
					<span>29 Aug 2015</span> &raquo;
					<a href="/angular/asp.net/github/gulp/html5/javascript/pluralsight/typescript/uncategorized/visual%20studio%20code/2015/08/29/learning-visual-studio-code.html">
					Learning Visual Studio Code</a>
				</li>
			
				<li>
					<span>23 May 2015</span> &raquo;
					<a href="/uncategorized/2015/05/23/visual-studio-code-webinar.html">
					Visual Studio Code Webinar</a>
				</li>
			
				<li>
					<span>23 May 2015</span> &raquo;
					<a href="/uncategorized/2015/05/23/automatically-restarting-asp-net-on-osx-with-dnxmon.html">
					Automatically Restarting ASP.NET on OSX with DNXMON</a>
				</li>
			
				<li>
					<span>23 May 2015</span> &raquo;
					<a href="/uncategorized/2015/05/23/getting-started-with-asp-net-5-on-osx.html">
					Getting Started with ASP.NET 5 on OSX</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/refactoring-with-visual-studio-code.html">
					Refactoring with Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/intellisense-witha-visual-studio-code.html">
					Intellisense with Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/git-and-preferences-in-visual-studio-code.html">
					Git and Preferences in Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/debugging-with-visual-studio-code.html">
					Debugging with Visual Studio Code</a>
				</li>
			
				<li>
					<span>29 Apr 2015</span> &raquo;
					<a href="/uncategorized/2015/04/29/visual-studio-code.html">
					Introducing Visual Studio Code</a>
				</li>
			
		</ul>
	</div>

</div>
<!-- sidebar.html end -->
        <div class="not-mobile row sidebar-extras">
            <table class="col-centered">
                <tbody>
                    <tr>
                        <td>
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="160x600"></div>
                        </td>
                        <td>
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="160x600"></div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="300x250"></div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="300x250"></div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="col-sm-8">
        <div class="page-header">
  <h1>Binding Children Rows to a DataGrid with ADO.NET DataRelations </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   February 
	   1st,
	     
	   2008
	 </span>
	  <div class="article_body">
	  <p>Over the past few days I've had a few questions regarding a situation where there is a list of parent rows (let's say Orders) loaded into a dropdown list and a list of child rows (let's say Order Details) loaded into a grid. The idea being that when the user selects the Order from the dropdown list, the Order Details grid loads that Order's Order Details records without querying the database again. The DataSet contains all of&nbsp;the Orders and their Order Details rows&nbsp;and they are related by a DataRelation. In this situation you only want the Order Details for the selected Order to be bound to the DataGrid. (In this sample I wil focus on how to do this using the <b>DataRowView.CreateChildView</b> method.) Here is what the web page will look like:</p>
<p><img alt="" src="/photos/jpapa/images/61700/original.aspx" border="0" /></p>
<p>So let's review the situation before going any further:</p>
<ol> <li> A single DataSet stores all Orders for a specific customer and all of those Orders' Order Details <li> The DataSet contains a DataRelation that relates the parent/child DataTables (Orders/Order Details) <li> The DataSet is read-only, for viewing purposes only. <li> The DataSet needs to be cached somewhere. <li> The data is not volatile <li> When an order is selected, only its Order Details should be displayed in the DataGrid</li> <p>First, to load the DataSet there is a method called RefreshDataSetFromDB. This hits the database, grabs the Orders and&nbsp;the Order Details, throws them into 2 DataTable objects within the same DataSet and relates them via a DataRelation.</p> <fieldset> <legend>Get the 2 Tables from the DB</legend> <span style="COLOR: black;font-size: 9pt;font-family:Arial;"><span style="COLOR: blue;">private</span> DataSet RefreshDataSetFromDB() <br />{ <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">string</span> sCn = "server=(local);database=northwind;integrated security=true;"; <br />&nbsp;&nbsp;&nbsp;&nbsp;DataSet ds = <span>new</span> DataSet(); <br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">using</span> (SqlConnection cn = <span style="COLOR: blue">new</span> SqlConnection(sCn)) <br />&nbsp;&nbsp;&nbsp;&nbsp;{ <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cn.Open(); <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">string</span> sqlOrders = "SELECT OrderID FROM ORDERS WHERE CustomerID = 'ALFKI'"; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">using</span> (SqlCommand cmd = <span style="COLOR: blue">new</span> SqlCommand(sqlOrders, cn)) <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">using</span> (SqlDataAdapter da = <span style="COLOR: blue">new</span> SqlDataAdapter(cmd)) <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;da.Fill(ds, "Orders"); <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuilder sb = <span style="COLOR: blue">new</span> StringBuilder(""); <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.Append("SELECT od.OrderID, p.ProductID, p.ProductName, od.UnitPrice, od.Quantity");<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.Append(" FROM [Order Details] od INNER JOIN Products p ON od.ProductID = p.ProductID"); <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.Append(" WHERE OrderID IN ("); <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.Append(" SELECT OrderID FROM Orders WHERE CustomerID = 'ALFKI')"); <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">string</span> sqlOrderDetails = sb.ToString(); <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">using</span> (SqlCommand cmd = <span style="COLOR: blue">new</span> SqlCommand(sqlOrderDetails, cn)) <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">using</span> (SqlDataAdapter da = <span style="COLOR: blue">new</span> SqlDataAdapter(cmd)) <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;da.Fill(ds, "Order Details"); <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds.Relations.Add("OrdersToOrderDetails", <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds.Tables["Orders"].Columns["OrderID"], <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds.Tables["Order Details"].Columns["OrderID"]); <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cn.Close(); <br />&nbsp;&nbsp;&nbsp;&nbsp;} <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">return</span> ds; <br />} <br /></span> </fieldset> <p>Normally I'd be using stored procedures here, but for simplicity sake of this code sample I used inline SQL. I also would not hard code the CustomerID, instead I would use a parameter passed in from somewhere (a post from another form, a control on this page, outer space, who knows). Since I built my inline SQL statement, notice the use of the StringBuilder class to build the SQL statement for the Order Details. Once I have to concatenate 3 lines or more, I use the StringBuilder. If I concatenate string objects together instead, the fact that strings are immutable means that I keep creating and throwing the value away. What's my point: StringBuilder good. Concat bad. </p> <p>I used the <a href="/blogs/john.papa/archive/2005/04/01/60984.aspx">using</a> statement quite a bit in the RefreshDataSetFromDB method. The <a href="/blogs/john.papa/archive/2005/04/01/60984.aspx"> using</a> statement will clean up my resources when its block ends. Quite a nice feature in my opinion. And while I am at it, I would not hard code my connection string. Instead I would store it in a custom config file or the web.config. </p> <p>Alright, that's relatively basic ADO.NET. To load the page I use the following code which grabs a DataSet. On the first call to the page I also load the Order rows into the dropdown list.</p> <fieldset> <legend>Page_Load</legend> <span style="COLOR: black;font-size: 9pt;font-family:Arial;"><br /><span style="COLOR: blue">private</span> <span style="COLOR: blue">void</span> Page_Load(object sender, System.EventArgs e) <br />{ <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: green">// Get the DataSet</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;DataSet ds = GetDataSetFromCache(); <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">if</span> (!IsPostBack) <br />&nbsp;&nbsp;&nbsp;&nbsp;{ <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoadOrdersList(ds); <br />&nbsp;&nbsp;&nbsp;&nbsp;} <br />} </span> </fieldset> <p><br /> When I call GetDataSetFromCache, it the DataSet is not in Cache, then I go get the data from the database using the RefreshDataSetFromDB method. Then I stick the DataSet in the Cache. <br /> </p> <fieldset> <legend>GetDataSetFromCache </legend> <span style="COLOR: black;font-size: 9pt;font-family:Arial;"><br /><span style="COLOR: blue">private</span> DataSet GetDataSetFromCache() <br />{ <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: green">// test // Cache.Remove("MyCachedDataSet");</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: green">// Get the DataSet from Cache</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;DataSet ds = (DataSet)Cache.Get("MyCachedDataSet"); <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">if</span> (ds == <span style="COLOR: blue">null</span>) <br />&nbsp;&nbsp;&nbsp;&nbsp;{ <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: green">// Get the DataSet and load it into Cache</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds = RefreshDataSetFromDB(); <br />&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;CacheDataSet(ds); <br />&nbsp;&nbsp;&nbsp;&nbsp;} <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: blue">return</span> ds; <br />} <br /></span> </fieldset> <p><br /> I cache the DataSet using the Cache.Insert method. Here, I am creating a key called MyCachedDataSet so I can grab the DataSet back out of Cache using this key. SInce the data does not change often, I am telling the Cache to store this data for 1 hour from now. You can play with this setting or the sliding expiration argument to get your desired effect. The final parameter tells the Cache what method to call when the DataSet is removed from the Cache. Here, I tell it to call the CacheCallback handler. <br /> </p> <fieldset> <legend>CacheDataSet</legend> <span style="COLOR: black;font-size: 9pt;font-family:Arial;"><br /><span style="COLOR: blue">private</span> <span style="COLOR: blue">void</span> CacheDataSet(DataSet ds) <br />{ <br />&nbsp;&nbsp;&nbsp;&nbsp;Cache.Insert("MyCachedDataSet", ds, <span style="COLOR: blue">null</span>, <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DateTime.Now.AddHours(1), Cache.NoSlidingExpiration, <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CacheItemPriority.Normal, <span style="COLOR: blue">new</span> CacheItemRemovedCallback(CacheCallback)); <br />} <br /></span> </fieldset> <p><br /> The CacheCallBack handler will reload the data from the database, throw the DataSet back in Cache and the load the Orders dropdown list once again. </p> <fieldset> <legend>CacheCallback</legend> <span style="COLOR: black;font-size: 9pt;font-family:Arial;"><br /><span style="COLOR: blue">private</span> <span style="COLOR: blue">void</span> CacheCallback(<span style="COLOR: blue">string</span> str, <span style="COLOR: blue">object</span> obj, CacheItemRemovedReason reason) <br />{ <br />&nbsp;&nbsp;&nbsp;&nbsp;DataSet ds = RefreshDataSetFromDB(); <br />&nbsp;&nbsp;&nbsp;&nbsp;CacheDataSet(ds); <br />&nbsp;&nbsp;&nbsp;&nbsp;LoadOrdersList(ds); <br />} <br /></span> </fieldset> <p><br /> Here is how the Orders dropdown list is loaded (using data binding). </p> <fieldset> <legend>LoadOrdersList</legend> <span style="COLOR: black;font-size: 9pt;font-family:Arial;"><br /><span style="COLOR: blue">private</span> <span style="COLOR: blue">void</span> LoadOrdersList(DataSet ds) <br />{ <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: green">// Load the Orders</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;DataView dv = <span style="COLOR: blue">new</span> DataView(ds.Tables["Orders"]); <br />&nbsp;&nbsp;&nbsp;&nbsp;ddlOrders.DataSource = dv; <br />&nbsp;&nbsp;&nbsp;&nbsp;ddlOrders.DataTextField = "OrderID"; <br />&nbsp;&nbsp;&nbsp;&nbsp;ddlOrders.DataValueField = "OrderID"; <br />&nbsp;&nbsp;&nbsp;&nbsp;ddlOrders.DataBind(); <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: green">// Clear the Order Details grid</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;dgOrderDetails.DataSource = <span style="COLOR: blue">null</span>; <br />&nbsp;&nbsp;&nbsp;&nbsp;dgOrderDetails.DataBind(); <br />} <br /></span> </fieldset> <p><br /> When the Reload button is clicked, the DataSet is removed from cache and then reloaded from the database. Then the DataSet is stored in Cache and the Orders dropdown list is reloaded. </p> <fieldset> <legend>btnReload_Click</legend> <span style="COLOR: black;font-size: 9pt;font-family:Arial;"><br /><span style="COLOR: blue">private</span> <span style="COLOR: blue">void</span> btnReload_Click(<span style="COLOR: blue">object</span> sender, System.EventArgs e) <br />{ <br />&nbsp;&nbsp;&nbsp;&nbsp;Cache.Remove("MyCachedDataSet"); <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: green">// Get the DataSet and load it into Cache</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;DataSet ds = RefreshDataSetFromDB(); <br />&nbsp;&nbsp;&nbsp;&nbsp;CacheDataSet(ds); <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoadOrdersList(ds); <br />} <br /></span> </fieldset> <p><br /> Now here is where the DataGrid is loaded. The btnGo_Click handler calls the LoadOrderDetailsGrid method, which will grab the Order Details rows that are direct children of the currently selected Order (selected in the droopdown list). </p> <fieldset> <legend>btnGo_Click</legend> <span style="COLOR: black;font-size: 9pt;font-family:Arial;"><br /><span style="COLOR: blue">private</span> <span style="COLOR: blue">void</span> btnGo_Click(<span style="COLOR: blue">object</span> sender, System.EventArgs e) <br />{ <br />&nbsp;&nbsp;&nbsp;&nbsp;LoadOrderDetailsGrid(); <br />} <br /></span> </fieldset> <p><br /> The method LoadOrderDetailsGrid loads the DataGrid with the approriate related child rows. To do this, it has to take the form of something that can be bound to a DataGrid. In thise case, the code creates a DataView using its overloaded method that accepts the DataTable, the filter criteria and the DataViewRowState. The key here is that the DataView will only contain the single row for the Order that has the selected OrderID. I could have used the Select method to pull out an array of DataRow object, but that does not bind directly to the grid. So instead, I create a DataRowView. The DataRowView is associated with the Orders DataTable's selected row. Next, the DataRowView's CreateChildView method uses the name of the DataRelation (OrdersToOrderDetails) to navigate from the selected Order row and down its children Order Details rows. This result can be bound to a DataGrid. </p> <fieldset> <legend>LoadOrderDetailsGrid</legend> <span style="COLOR: black;font-size: 9pt;font-family:Arial;"><br /><span style="COLOR: blue">private void</span> LoadOrderDetailsGrid() <br />{ <br />&nbsp;&nbsp;&nbsp;&nbsp;DataSet ds = GetDataSetFromCache(); <br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="COLOR: green">// Load the children rows</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;DataView dv = <span style="COLOR: blue">new</span> DataView(ds.Tables["Orders"], "OrderID = " + ddlOrders.SelectedValue, "", DataViewRowState.CurrentRows); <br />&nbsp;&nbsp;&nbsp;&nbsp;DataRowView drv = dv[0]; <br />&nbsp;&nbsp;&nbsp;&nbsp;dgOrderDetails.DataSource = drv.<b> CreateChildView</b>("OrdersToOrderDetails"); <br />&nbsp;&nbsp;&nbsp;&nbsp;dgOrderDetails.DataBind(); <br />} <br /></span> </fieldset> <br /> This isn't the only way to solve the requirements, of course. But it does handle the caching, ADO.NET and the hierarchical requirements. <br /> 

</li></li></li></li></li></ol>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#all-ref">
					all <span>(348)</span>
					
				</a></li>
			
		  
		</ul>
		  

		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=Binding Children Rows to a DataGrid with ADO.NET DataRelations&via=john_papa"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="http://www.gravatar.com/avatar/0d3794fe37746ea54926ca6878712721" class="img-rounded author-image" />
        <h4 class="section-title author-name">John Papa</h4>
        <p class="author-bio">Evangelist on the Loose</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/all/2008/02/01/ado-net-performance-test-getting-a-single-value.html" title="ADO.NET Performance Test&#58; Getting a Single Value">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/all/2008/02/01/c-casting-quiz.html" title="C# Casting Quiz">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>



    
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'johnpapa';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>





      <footer class="footer-text">
        <hr/>
        <p>
        Copyright © 2015 - John Papa Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/">CC BY 2.5</a>
        | Unless otherwise stated or granted, code samples licensed under the <a href="http://sm.mit-license.org/">MIT license</a>.
        | Site design based on the <a href="https://github.com/dbtek/dbyll">dbyll theme</a> under the <a href="http://sm.mit-license.org/">MIT license</a>
      </p>

      </footer>

    </div>

    <script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/app.js"></script>

    <!--Developer Media Links-->
    <script type='text/javascript'>
        function _dmBootstrap(file) {
    var _dma = document.createElement('script'); _dma.type = 'text/javascript'; _dma.async = true; _dma.src = ('https:' == document.location.protocol ? 'https://' : 'http://')
    + file;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(_dma);
    }
    function _dmFollowup(file) { if (typeof DMAds === 'undefined') _dmBootstrap('cdn2.DeveloperMedia.com/a.min.js');}
    (function () { _dmBootstrap('cdn1.DeveloperMedia.com/a.min.js');
    setTimeout(_dmFollowup, 2000);})();
    </script>

    <!--<script language="JavaScript" src="http://ad.doubleclick.net/N6839/adj/lqm.johnpapa.site/ron;kw=%2Cjohn%2Cpapa%2Cblog%2Cjohnpapa%7Bdot%7Dnet%2Cjohnpapa%2Cpappa%2Cwww%7Bdot%7Djohnpapa%7Bdot%7Dnet%2Cjon%2Cangular%2Cjhon;sz=160x600;dc_ref=http%3A%2F%2Fwww.johnpapa.net%2F;tile=1;ord=BEAAB484DA88D8D84B9DCB004E5712BE?"
    type="text/javascript"></script>-->

    <div data-type="ad" data-publisher="lqm.johnpapa.site" data-zone="ron" data-format="728x90" class="col-centered"></div>

</body>

</html>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'johnpapa']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

